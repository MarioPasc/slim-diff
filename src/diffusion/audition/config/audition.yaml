# Real vs Synthetic Audition Configuration
# =========================================
# This configuration controls the audition system for evaluating
# distinguishability between real and synthetic epilepsy lesion patches

# Experiment metadata
experiment:
  name: "audition_real_vs_synthetic"
  seed: 42

# Data paths and settings
data:
  # Real data configuration
  real:
    cache_dir: /media/mpascual/Sandisk2TB/research/epilepsy/data/slice_cache
    slices_subdir: slices
    csv_files:
      - train.csv
      - val.csv
      - test.csv

  # Synthetic data configuration
  synthetic:
    replicas_dir: /media/mpascual/Sandisk2TB/research/epilepsy/results/replicas_jsddpm_sinus_kendall_weighted_anatomicalprior/replicas
    replica_ids: [0, 1, 2, 3, 4, 6, 7, 8, 9, 10]
    sampling_strategy: "random_pooled"  # Pool samples from all replicas

  # Patch extraction settings
  patch_extraction:
    method: "dynamic"  # "dynamic" finds largest lesion, "fixed" uses fixed size
    padding: 8         # Extra padding around bounding box (pixels)
    min_patch_size: 32
    max_patch_size: 96
    # For fixed method only:
    fixed_size: 64

  # Train/val/test splitting
  splitting:
    test_ratio: 0.2
    val_ratio: 0.1
    min_samples_per_zbin: 5  # Minimum samples per z-bin in test set
    stratify_by: "z_bin"
    random_state: 42

# Model architecture
model:
  type: "simple_cnn"
  in_channels: 2        # image + mask concatenated
  channels: [32, 64, 128]
  fc_dim: 256
  dropout: 0.3
  use_batch_norm: true

# Training configuration
training:
  batch_size: 64
  max_epochs: 50
  learning_rate: 1.0e-4
  weight_decay: 1.0e-5
  optimizer: "adam"

  # Learning rate scheduler
  scheduler:
    enabled: true
    type: "reduce_on_plateau"
    factor: 0.5
    patience: 5
    min_lr: 1.0e-6

  # Early stopping
  early_stopping:
    enabled: true
    monitor: "val/auc"
    mode: "max"
    patience: 10
    min_delta: 0.001

  # Precision
  precision: "32-true"

  # Data loading
  num_workers: 4
  pin_memory: true

# Logging configuration
logging:
  # Checkpointing
  checkpointing:
    save_top_k: 3
    monitor: "val/auc"
    mode: "max"
    filename: "audition-epoch={epoch:02d}-val_auc={val/auc:.4f}"

  # CSV logging
  csv_logging:
    enabled: true

  # WandB (optional)
  wandb:
    enabled: false
    project: "audition-real-vs-synthetic"
    entity: null

# Evaluation settings
evaluation:
  # Bootstrap confidence intervals
  bootstrap:
    enabled: true
    n_iterations: 1000
    confidence_level: 0.95

  # Per z-bin analysis
  per_zbin:
    enabled: true
    min_samples: 10  # Minimum samples for z-bin to be included

  # Threshold optimization
  threshold:
    method: "youden"  # "youden" or "f1"

# Output paths
output:
  base_dir: /media/mpascual/Sandisk2TB/research/epilepsy/results/replicas_jsddpm_sinus_kendall_weighted_anatomicalprior/classifier_audition
  patches_dir: ${output.base_dir}/patches
  splits_dir: ${output.base_dir}/splits
  checkpoints_dir: ${output.base_dir}/checkpoints
  results_dir: ${output.base_dir}/results
  logs_dir: ${output.base_dir}/logs
  figures_dir: ${output.base_dir}/results/figures
