# Classification Task Configuration
# ==================================
# Master config for ICIP 2026 lesion quality assessment.
# Assesses whether synthetic lesions are distinguishable from real ones.

experiment:
  name: "icip2026_lesion_classification"
  seed: 42

# ---------------------------------------------------------------------------
# Data
# ---------------------------------------------------------------------------
data:
  # Real data (slice cache)
  real:
    cache_dir: "/media/mpascual/Sandisk2TB/research/jsddpm/data/epilepsy/slice_cache"
    csv_files: ["train.csv", "val.csv"]
    slices_subdir: "slices"

  # Synthetic data
  # Expected structure: {results_base_dir}/{experiment_name}/{replicas_subdir}/replica_NNN.npz
  synthetic:
    results_base_dir: "/media/mpascual/Sandisk2TB/research/jsddpm/results/epilepsy/icip2026/runs"
    experiments:
      - name: "epsilon_lp_1.5"
        replicas_subdir: "replicas"
        replica_ids: [0, 1, 2, 3, 4]
      - name: "epsilon_lp_2.0"
        replicas_subdir: "replicas"
        replica_ids: [0, 1, 2, 3, 4]
      - name: "epsilon_lp_2.5"
        replicas_subdir: "replicas"
        replica_ids: [0, 1, 2, 3, 4]
      - name: "velocity_lp_1.5"
        replicas_subdir: "replicas"
        replica_ids: [0, 1, 2, 3, 4]
      - name: "velocity_lp_2.0"
        replicas_subdir: "replicas"
        replica_ids: [0, 1, 2, 3, 4]
      - name: "velocity_lp_2.5"
        replicas_subdir: "replicas"
        replica_ids: [0, 1, 2, 3, 4]
      - name: "x0_lp_1.5"
        replicas_subdir: "replicas"
        replica_ids: [0, 1, 2, 3, 4]
      - name: "x0_lp_2.0"
        replicas_subdir: "replicas"
        replica_ids: [0, 1, 2, 3, 4]
      - name: "x0_lp_2.5"
        replicas_subdir: "replicas"
        replica_ids: [0, 1, 2, 3, 4]

  # Patch extraction settings
  patch_extraction:
    method: "dynamic"         # "dynamic" computes size from max lesion bbox; "fixed" uses fixed_size
    padding: 8                # Padding around lesion bbox (pixels)
    min_patch_size: 32        # Minimum patch dimension
    max_patch_size: 96        # Maximum patch dimension
    fixed_size: 64            # Used when method="fixed"

  # K-fold cross-validation
  kfold:
    n_folds: 5
    stratify_by: "z_bin"
    seed: 42

  # Input modes to evaluate
  input_modes: ["joint", "image_only", "mask_only"]
  # "joint":      2-channel (image + mask) — overall paired quality
  # "image_only": 1-channel (FLAIR patch) — texture quality
  # "mask_only":  1-channel (mask patch) — shape/boundary quality

# ---------------------------------------------------------------------------
# Model
# ---------------------------------------------------------------------------
model:
  # Path to model architecture YAML (relative to this file's directory)
  config_path: "models/simple_cnn.yaml"

# ---------------------------------------------------------------------------
# Training
# ---------------------------------------------------------------------------
training:
  batch_size: 64
  max_epochs: 50
  learning_rate: 1.0e-4
  weight_decay: 1.0e-5
  optimizer: "adam"

  scheduler:
    type: "reduce_on_plateau"
    factor: 0.5
    patience: 5
    min_lr: 1.0e-6

  early_stopping:
    monitor: "val/auc"
    mode: "max"
    patience: 10
    min_delta: 0.001

  precision: "32-true"
  num_workers: 4
  pin_memory: true

# ---------------------------------------------------------------------------
# Evaluation
# ---------------------------------------------------------------------------
evaluation:
  # Bootstrap confidence intervals
  bootstrap:
    n_iterations: 2000
    confidence_level: 0.95
    seed: 42

  # Permutation test for H0: AUC = 0.5
  permutation_test:
    n_permutations: 10000
    alpha: 0.05
    seed: 42

  # Per-z-bin analysis
  per_zbin:
    enabled: true
    min_samples: 10

  # Real-vs-real control experiment
  control:
    enabled: true
    n_repeats: 5

# ---------------------------------------------------------------------------
# Output
# ---------------------------------------------------------------------------
output:
  base_dir: "/media/mpascual/Sandisk2TB/research/jsddpm/results/epilepsy/icip2026/classification"
  patches_subdir: "patches"
  results_subdir: "results"
  checkpoints_subdir: "checkpoints"
  figures_subdir: "figures"
  tables_subdir: "tables"
